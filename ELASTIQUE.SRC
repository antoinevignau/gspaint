;======================================================;;                                                      ;;              E L A S T I Q U E                       ;;                                                      ;;======================================================;Elastique      Start               Using AllEqu               Using Data               Using CursPat               Using Cursor               Lda  TopSelect               Cmp  #TypeSelect               Beq  OkElastique               RtsOkElastique    Anop               MoveLong PtrOutLine,CurPtrOutLine               MoveLong PtrSelect,CurPtrSelect               MoveLong EvtWhere,Initialy               MoveRect DragRect,TheRect               MoveRect DragRect,ElastSvDrag               Sec               Lda  DragRect+4               Sbc  DragRect               Sta  SrcRect+4               Sec               Lda  DragRect+6               Sbc  DragRect+2               Sta  SrcRect+6;----- Calcul de quel rectangle -----               Lda  SrcRect+4               Lsr  A               Clc               Adc  DragRect               Sta  Midy               Lda  SrcRect+6               Lsr  A               Clc               Adc  DragRect+2               Sta  Midx               Lda  Evtx               Cmp  Midx               Blt  Cas14               Lda  Evty               Cmp  Midy               Blt  Cas2               Lda  #4               Bra  SuiteCas2           Anop               Lda  #2               Bra  SuiteCas14          Anop               Lda  Evty               Cmp  Midy               Blt  Cas1               Lda  #6               Bra  SuiteCas1           Anop               Lda  #0Suite          Anop               Sta  NumRect               Pha               Pha               _GetCursorAdr               PushLong FlechePtr               _SetCursorGetNext        Anop               MoveLong EvtWhere,Py               Pha               Pea  $FFFF               PushPtr EventRecord               _GetNextEvent               Pla               Lda  EvtWhat               Cmp  #MouseUp               Jeq  GetOutSSS1           Anop               PushPtr EvtWhere               _GlobalToLocal               Jsr  MapEvtWhere               Jsr  LocalGrid               Sec               Lda  Evtx               Sbc  Px               Sta  Deltax               Sec               Lda  Evty               Sbc  Py               Sta  Deltay               Bne  SSS2               Lda  Deltax               Jeq  GetNextSSS2           Anop               Jsr  FrameDotted               Ldx  NumRect               Jsr  (Calcul,x)               MoveRect DragRect,Firsty               MoveRect TheRect,DragRect               CSgnBge DragRect+4,DragRect,NoSwapy               ldx  DragRect               lda  DragRect+4               sta  DragRect               stx  DragRect+4Noswapy        Anop               CSgnBge DragRect+6,DragRect+2,NoSwapx               ldx  DragRect+2               lda  DragRect+6               sta  DragRect+2               stx  DragRect+6NoSwapx        Anop                       CSgnBge DragRect,WiewRec,OkY1               Lda  WiewRec               Sta  DragRectOkY1           Anop               CSgnBge DragRect+2,WiewRec+2,OkX1               Lda  WiewRec+2               Sta  DragRect+2OkX1           Anop               CSgnBle DragRect+4,WiewRec+4,OkY2               Lda  Wiewrec+4               Sta  DragRect+4OkY2           Anop               CSgnBle DragRect+6,WiewRec+6,OkX2               Lda  WiewRec+6               Sta  DragRect+6OkX2           Anop               Lda  DragRect               Cmp  Firsty               Bge  NoFy               Sta  FirstYNoFy           Lda  DragRect+2               Cmp  Firstx               Bge  NoFx               Sta  FirstxNoFx           Lda  DragRect+4               Cmp  Lasty               Blt  NoLy               Sta  LastyNoLy           Lda  DragRect+6               Cmp  Lastx               Blt  NoLx               Sta  LastxNoLx           Anop               Jsr  Affiche               Jsr  FrameDotted               Brl  GetNextGetOut         Anop;----- Recopie l'objet Scaler dans Select -----               MoveLong PtrOutLine,Ptr10               MoveLong PtrSelect,Ptr14               Ldy  #(Paintx*Painty/2)-2Loop1          Anop               Lda  [Ptr10],y               Pha               Lda  [Ptr14],y               Sta  [Ptr10],y               Pla               Sta  [Ptr14],y               Dey               Dey               Bpl  Loop1               Clc               Lda  DragRect               Adc  DragRect+4               Lsr  A               Sta  FatBitOrg               Clc               Lda  DragRect+2               Adc  DragRect+6               Lsr  A               Sta  FatBitOrg+2               _SetCursor               Lda  #UndoElast               Sta  TopUndo               MoveRect DragRect,SvDragRect    Pour le Undo               Rts;------------------------------------------------------;;              Calcul;Calcul         Anop               dc   i'Calcul0'               dc   i'Calcul2'               dc   i'Calcul4'               dc   i'Calcul6'Calcul0        Anop               Clc               Lda  TheRect               Adc  Deltay               Sta  TheRect               Clc               Lda  TheRect+2               Adc  Deltax               Sta  TheRect+2               RtsCalcul2        Anop               Clc               Lda  TheRect               Adc  Deltay               Sta  TheRect               Clc               Lda  TheRect+6               Adc  Deltax               Sta  TheRect+6               RtsCalcul4        Anop               Clc               Lda  TheRect+4               Adc  Deltay               Sta  TheRect+4               Clc               Lda  TheRect+6               Adc  Deltax               Sta  TheRect+6               RtsCalcul6        Anop               Clc               Lda  TheRect+4               Adc  Deltay               Sta  TheRect+4               Clc               Lda  TheRect+2               Adc  Deltax               Sta  TheRect+2               Rts;------------------------------------------------------;;              Affiche;Affiche        Anop               Sec               Lda  DragRect+4               Sbc  DragRect               Sta  DstRect+4               Sec               Lda  DragRect+6               Sbc  DragRect+2               Sta  DstRect+6               PushPtr CopyParms               Jsr  CopyBits               Sec               Lda  Firstx               Sbc  WiewRec+2               And  #$FFFC               Lsr  A               Sta  Firstx               Sec               Lda  Lastx               Dea               Sbc  WiewRec+2               And  #$FFFC               Lsr  A               Ina               Ina               Sta  Lastx               Lda  Firsty               Jsr  Mul160               Clc               Adc  PtrStock               Sta  Ptr10               Lda  PtrStock+2               Sta  Ptr10+2               Lda  WiewRec+2               Lsr  A               Clc               Adc  Ptr10               Sta  Ptr10               Sec               Lda  Firsty               Sbc  WiewRec               Jsr  Mul160               Clc               adc  #<AdrBase               Sta  Ptr14               Lda  #^AdrBase               Sta  Ptr14+2               MoveLong PtrOutLine,Ptr18               MoveLong PtrMask,Ptr40               PushLong Firsty               PushLong Lasty               PushLong #$FFFFFFFF      Pas de Limite pour l'objet               Jsr  RestoSelect               Ldx  Firsty               Ldy  Lasty               Jsr  RestoFatBit               Rts;------------------------------------------------------;;              DoUndoElast;DoUndoElast    Entry               MoveLong PtrOutLine,Ptr10               MoveLong PtrSelect,Ptr14               Ldy  #(Paintx*Painty/2)-2Loop3          Anop               Lda  [Ptr14],y               Pha               Lda  [Ptr10],y               Sta  [Ptr14],y               Pla               Sta  [Ptr10],y               Dey               Dey               Bpl  Loop3               MoveRect ElastSvDrag,TheRect               MoveRect DragRect,ElastSvDrag               MoveRect TheRect,DragRect               Jsr  SelectOff               Jsr  StockToScreen               MoveLong DragRect,EvtWhere               Jsr  RedrawSelect               Jsr  SelectOn               Rts;------------------------------------------------------;;              Data;Deltay         ds   2Deltax         ds   2Py             ds   2Px             ds   2Initialy       ds   2Initialx       ds   2NumRect        ds   2Midy           ds   2Midx           ds   2TheRect        ds   8ElastSvDrag    ds   8Firsty         ds   2Firstx         ds   2Lasty          ds   2Lastx          ds   2CopyParms      Anop               dc   i4'Select_Li'       Origine               dc   i4'OutLine_Li'      Destination               dc   i4'SrcRect'               dc   i4'DstRect'               dc   i'PenCopy'               dc   I4'0'SrcRect        Dc   i'0,0,0,0'DstRect        dc   i'0,0,0,0'               End